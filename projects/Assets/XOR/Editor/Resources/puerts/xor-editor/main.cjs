(()=>{"use strict";var e={3110:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerEvent=void 0,(r=t.WorkerEvent||(t.WorkerEvent={})).Ready="ready",r.StartProgream="startProgream",r.FileChanged="fileChanged"},5957:e=>{e.exports=require("csharp")},2048:e=>{e.exports=require("fs")}},t={};function r(i){var o=t[i];if(void 0!==o)return o.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,r),s.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),(()=>{const e=r(5957),t=r(3110),{Path:i}=e.System.IO;class o{constructor(e){this.ci=e}start(r,o){if(this._worker&&this._worker.isAlive)throw new Error("invalid operation");const s=this._createWorker(),n=new e.XOR.Services.Program;if(n.root=i.GetDirectoryName(r),n.Reset(),s.post(t.WorkerEvent.StartProgream,{project:r,program:n},!0),this._worker=s,this.ci.SetWorker.Invoke(s.source),this.ci.SetProgram.Invoke(n),o)try{let t=i.GetDirectoryName(r);this._watcher=this._createWatcher(t),e.XOR.Logger.Log(`<b>nodejs.FSWacther:</b> ${t}`)}catch(e){console.error(e)}}stop(){this._watcher&&this._watcher.close(),this._watcher=null,this._worker&&this._worker.stop(),this._worker=null,this.ci.SetWorker.Invoke(null),this.ci.SetProgram.Invoke(null)}bind(){let t=new e.XOR.Services.TSInterfaces;return t.Stop=()=>this.stop(),t.Start=(e,t)=>this.start(e,t),t.FileChanged=e=>this.change(e),t}change(e){this._changeEvents?this._changeEvents.add(e):(this._changeEvents=new Set,this._changeEvents.add(e),setTimeout((()=>{this.sendChangeEvent([...this._changeEvents]),this._changeEvents=null}),100))}sendChangeEvent(e){this._worker&&this._worker.isAlive&&this._worker.isInitialized?this._worker.post(t.WorkerEvent.FileChanged,e,!0):console.warn("worker is not alive or initializing:")}_createWorker(){const t=new e.XOR.ThreadDebuggerOptions,r=new e.XOR.ThreadOptions;r.remote=!1,r.isEditor=!0,r.debugger=t;const i=new e.XOR.MixerLoader,o=new xor.ThreadWorker(i,r);return o.start("puerts/xor-editor/child"),xor.globalListener.quit.add((()=>o.stop())),o}_createWatcher(e){const t=r(2048),o=[".ts",".tsx"],s=t.watch(e,{encoding:"utf8",persistent:!0,recursive:!0},((t,r)=>{"string"==typeof r&&o.includes(i.GetExtension(r))&&this.change(i.GetFullPath(i.Combine(e,r)))}));return xor.globalListener.quit.add((()=>s.close())),s}}function s(e){return new o(e).bind()}!function(){(r.g||globalThis||this).init=s}()})()})();